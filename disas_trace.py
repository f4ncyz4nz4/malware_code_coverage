from minidump import minidumpfile, minidumpreader
from capstone import *
import re


def disasembly(code, va):
    for i in md.disasm(code, va):
        print("0x%x:\t%s\t%s" % (i.address, i.mnemonic, i.op_str))
        break


md = Cs(CS_ARCH_X86, CS_MODE_32)
minidump_file = minidumpfile.MinidumpFile.parse(
    "./1d713ad7ee3a43432d6188707943ee9ef07241bbc7bda376a068989d7a248143.dmp")
minidump_reader = minidump_file.get_reader()

bbl_string = open(
    './1d713ad7ee3a43432d6188707943ee9ef07241bbc7bda376a068989d7a248143.bbl').read()
bbl_list = re.findall('.{1,8}', bbl_string)


for bbl in bbl_list:
    va = int(bbl, 16)
    if va > 0:
        code = minidump_reader.read(va, 0x20)
        disasembly(code, va)
